<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>reveal.js</title>

		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/serif.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/monokai.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">

        <section data-transition="slide-in fade-out">
          <h2>Protractor</h2>
          <h3>on the top of the Testing Pyramid</h3>
        </section>

        <section data-transition="fade-in slide-out">
          <img class="plain" src="./img/angular-protractor.png" alt="Protractor Logo">
          <br/>
          <p class="fragment fade-up">Protractor is an end-to-end test framework for Angular and AngularJS applications.</p>
          <p class="fragment fade-in">Protractor runs tests against your application running in a real browser, interacting with it as a user would.</p>
        </section>

        <section>
          <h4>How It Works</h4>
          <section>
            <img class="plain fragment fade-in" src="./img/components.png" alt="components">
            <ul style="font-size: 70%">
              <li class="fragment fade-in">Protractor is a Node.js program</li>
              <li class="fragment fade-in">Protractor is a wrapper around WebDriverJS</li>
              <li class="fragment fade-in">Selenium is a browser automation framework, includes Selenium Server, the WebDriver APIs, and the WebDriver browser drivers.</li>
            </ul>
          </section>
        </section>

        <section>
            <h3>Protractor needs two files to run:</h3>
            <p class="fragment fade-up">1. Configuration file</p>
            <p class="fragment fade-up">2. Test or spec file</p>
        </section>

        <section>
          <h4>Configuration file:</h4>
          <section>
<pre><code class="hljs" data-line-numbers="1-9">
  capabilities: {
    browserName: 'chrome',
    maxInstances: 3,
    chromeOptions: {
        args: [ "--headless", "--window-size=800,600" ]
      }
  }

</code></pre>
            <div class="fragment fade-in">
              <p style="font-size: 50%">Protractor supports the two latest major versions of Chrome, Firefox, Safari, and IE.</p>
              <img class="plain" src="./img//browsers.png" alt="Browsers">
            </div>
          </section>

          <section>
<pre><code class="hljs" data-line-numbers="1-5">
    directConnect: true,
    framework: 'jasmine'

  </code></pre>
          </section>

          <section>
<pre><code class="hljs" data-line-numbers="1-10">
  onPrepare() {
    require('ts-node').register({
      project: require('path').join(__dirname, './tsconfig.json')
    });
    jasmine.getEnv().addReporter(new SpecReporter({
      spec: { displayStacktrace: true }
    }));
  }

</code></pre>
          </section>
        </section>

        <section>
          <h4>Spec/test file</h4>
          <section>
<pre><code class="hljs" data-line-numbers="1-13">
  describe('App Greeting page', async () => {
    it('should greet the named user', async () => {
      await browser.get('/greeting');

      await element(by.name('userName')).sendKeys('John');

      const greeting = element(by.className('greeting'));

      expect(greeting.getText()).toEqual('Hello John!');
    });
  });

</code></pre>
            <ul style="list-style-type: none;">
              <li class="fragment fade-up">Protractor and Jasmin syntax only...</li>
              <li class="fragment fade-up">any interaction with application code</li>
            </ul>
          </section>

          <section>
<pre><code class="hljs" data-line-numbers="1-15">
  it('should add new Post Message', async () => {
    await browser.get('/posts-page');
    await element(by.css('.user-message-input'))
      .sendKeys('My test message');
    await element(by.id('submitButton'))
      .click();

    expect(await element.all(by.className('post'))
      .get(0)
      .getText())
      .toContain('My test message');
  });

</code></pre>
            <p style="font-size: 70%">Protractor API part:</p>
            <ul style="font-size: 70%">
              <li class="fragment fade-up">browser.get('/')</li>
              <li class="fragment fade-up">element(by.css()), by.id(), by.className()</li>
              <li class="fragment fade-up">element().click(), .getText(), .all().get(0)</li>
            </ul>
          </section>
        </section>

        <section>
          <h2>Tests organization</h2>
          <h4>for building an Efficient Ecosystem</h4>
        </section>

        <section>
          <h4>Pattern Page Object</h4>
          <p class="fragment fade-up">...simply models pages as objects within the test code.</p>
          <br>
          <h6 class="fragment fade-up">Helps to avoid:</h6>
          <ul style="list-style-type: none; font-size: 70%">
            <li class="fragment fade-up">- Code duplication</li>
            <li class="fragment fade-up">- Maintenance problem</li>
            <li class="fragment fade-up">- Hard to understand</li>
          </ul>
        </section>

        <section>
          <h4>Page Object</h4>
          <p style="font-size: 70%"><i style="color: darkslategrey;">posts.po.ts</i> or <i style="color: darkslategrey;">posts.page-object.ts</i></p>
          <section data-transition="slide-in fade-out">
<pre><code class="hljs" data-line-numbers="1-15">
import { browser, by, element, ElementFinder } from 'protractor';

export class PostsPage extends BasePage {

  public async navigateToPostsPage(): Promise<void> {
    return super.navigateTo('/posts-page');
  }

  public getEnterPostMessageInputField(): ElementFinder {
    return element(by.css('.user-message-input'));
  }

 // more methods...
}

</code></pre>
          </section>
          <section data-transition="fade-in">
<pre><code class="hljs" data-line-numbers="1-16">
  public async enterPostMessage(message: string): Promise<void> {
    return this.getEnterPostMessageInputField()
      .sendKeys('My test message');
  }

  public getPublishPostButton(): ElementFinder {
    return element(by.id('submitButton'));
  }

  public async clickPublishPostButton(): Promise<void> {
    return this.getPublishPostButton().click();
  }

  public async getLastPublishedPostMessage(): Promise<string> {
    return await element.all(by.className('post'))
      .get(0)
      .getText();
  }
}

</code></pre>

        </section>
      </section>

      <section>
        <h4>Usage Page Object in spec file</h4>
        <p style="font-size: 70%"><i style="color: darkslategrey;">posts.e2e-spec.ts</i></p>
          <section>
<pre><code class="hljs" data-line-numbers="1-15">
import { PostsPage } from './posts-page.po';

describe('Posts Page', async () => {
  let postsPO: PostsPage;

  beforeAll(async () => {
    postsPO = new PostsPage();
    postsPO.navigateToPostsPage();
  });

</code></pre>
          </section>
          <section>
<pre><code class="hljs" data-line-numbers="1-15">
it('should add new Post Message', async () => {
  await postsPO.enterPostMessage('My test message');
  await postsPO.clickPublishPostButton();

  expect(await postsPO.getLastPublishedPostMessage())
    .toContain('My test message');
});

</code></pre>
          </section>
          <section>
<pre><code class="hljs" data-line-numbers="1-15">
it('should add new post message', async () => {
  await element(by.css('.user-message-input'))
    .sendKeys('My test message');
  await element(by.id('submitButton'))
    .click();

  expect(await element.all(by.className('post'))
    .get(0)
    .getText())
    .toContain('My test message');
});

</code></pre>
          </section>
        </section>

        <section>
          <h4>Project Structure</h4>
          <p style="font-size: 70%;">Group your e2e tests in a structure that makes sense to the structure of your project</p>
<pre><code class="hljs" data-line-numbers="1-15">
  |-- test
    |-- unit
    |-- e2e
      |-- page-objects
          home-page.js
          profile-page.js
          contacts-page.js
      home-spec.js
      profile-spec.js
      contacts-spec.js

</code></pre>
        <ul style="font-size: 70%;">
          <li class="fragment fade-up">Finding your e2e related files should be intuitive and easy</li>
          <li class="fragment fade-up">Makes the folder structure more readable</li>
          <li class="fragment fade-up">Clearly separates e2e tests from unit tests</li>
        </ul>
        </section>

        <section>
          <img class="plain" src="./img/pitfals.jpg" alt="Meme_pitfals">
        </section>

        <section>
          <h4>Timeouts</h4>
          <p class="fragment fade-up" style="font-size: 70%;">Because WebDriver tests are asynchronous and involve many components, there are several reasons why a timeout could occur in a Protractor test.</p>
        </section>

        <section>
          <h4>Protractor Timeouts</h4>
          <section>
            <img class="plain fragment fade-up" src="./img/script_timeout.png" alt="Error">
            <p class="fragment fade-up" style="font-size: 50%;">or</p>
            <img class="plain fragment fade-up" src="./img/timeout.png" alt="Error">
            <p class="fragment fade-up" style="font-size: 50%;">...it can ocure becouse</p>
            <p class="fragment fade-up" style="font-size: 70%;">With Protractor, the test script is run using Node.js. Protractor runs an extra command before performing any action on the browser to ensure that the application being tested has stabilized.</p>
          </section>

          <section>
            <p style="font-size: 70%;">Solution</p>
            <p class="fragment fade-up" style="font-size: 70%;">...increase timeouts</p>
            <p class="fragment fade-up" style="font-size: 70%;">Globaly in Protractor config file</p>
<pre class="fragment fade-up"><code class="hljs" data-line-numbers="2, 5">
allScriptsTimeout: timeout_in_millis,
jasmineNodeOpts: {
  showColors: true,
  defaultTimeoutInterval: timeout_in_millis,
  print: function() {}
},

</code></pre>
            <p class="fragment fade-up" style="font-size: 70%;">For Jasmine in certain spec file </p>
<pre class="fragment fade-up"><code class="hljs" data-line-numbers="2, 5">
  jasmine.DEFAULT_TIMEOUT_INTERVAL = timeout_in_millis;

</code></pre>
          </section>

          <section>
            <p>But...</p>
            <p class="fragment fade-up" style="font-size: 70%;">For Angular apps, Protractor will wait until the Angular Zone stabilizes. This means long running async operations will block your test from continuing.</p>
            <p class="fragment fade-up" style="font-size: 70%;">To work around this, run these tasks outside the Angular zone.</p>
<pre class="fragment fade-up"><code class="hljs" data-line-numbers="1-11">
    this.ngZone.runOutsideAngular(() => {
      setTimeout(() => {
        // Changes here will not propagate into your view.
        this.ngZone.run(() => {
          // Run inside the ngZone to trigger change detection.
        });
      }, REALLY_LONG_DELAY);
    });

</code></pre>
          </section>
        </section>

        <section>
            <h4>Non Angular Application</h4>
            <p class="fragment fade-up" style="font-size: 70%;">Navigating to third-party resources may come as a surprise</p>
            <img class="plain fragment fade-up" src="./img/non-angular.png" alt="Error">
            <p class="fragment fade-up" style="font-size: 70%;">You can turn off waiting for Angular by setting</p>
<pre class="fragment fade-up"><code class="hljs" data-line-numbers="1-8">
browser.waitForAngularEnabled(false);
browser.get('/non-angular-login-page.html');

// do something...

browser.waitForAngularEnabled(true);
browser.get('/page-containing-angular.html');

</code></pre>
        </section>

        <section>
          <h2>Best Practices</h2>
          <ul>
            <li class="fragment fade-up">Use TypeScript instead of JavaScript</li>
            <li class="fragment fade-up">Implement Page Object Pattern</li>
            <li class="fragment fade-up">One TypeScript file, one page object class</li>
            <li class="fragment fade-up">Deal with JavaScript’s asynchronous behavior using async & await</li>
            <li class="fragment fade-up">Test case should only call page object’s methods</li>
            <li class="fragment fade-up">Avoid hidden assertions in the page object classes</li>
            <li class="fragment fade-up">Have simple but effective project structure</li>
            <li class="fragment fade-up">Test your test code more frequently</li>
          </ul>
        </section>

        <section>
          <h2>Summarize</h2>
          <ul>
            <li class="fragment fade-up">protractor is e2e test Framework for Angular applications supplied out of the box</li>
            <li class="fragment fade-up">Wraps Selenium and provides us with improved syntax and special built-in hooks for Angular.</li>
            <li class="fragment fade-up">TypeScript support is available and the library is operated and maintained by the huge Angular team.</li>
            <li class="fragment fade-up"><a href="https://angular.io/guide/testing">Angular official documentation</a> suggests using this tool.</li>
          </ul>
        </section>

        <section>
          <h2>Thank You</h2>
        </section>

			</div>
		</div>

		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true }
				]
			});
		</script>
	</body>
</html>
